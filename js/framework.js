if(void 0===window.jQuery)throw new Error("The jQuery library is not loaded. The OctoberCMS framework cannot be initialized.");if(void 0!==window.jQuery.request)throw new Error("The OctoberCMS framework is already loaded.");!function($){"use strict";var Request=function(element,handler,options){var $el=this.$el=$(element);if(this.options=options||{},void 0===handler)throw new Error("The request handler name is not specified.");if(!handler.match(/^(?:\w+\:{2})?on*/))throw new Error('Invalid handler name. The correct handler name format is: "onEvent".');var $form=options.form?$(options.form):$el.closest("form"),$triggerEl=$form.length?$form:$el,context={handler:handler,options:options};if(void 0!==options.browserValidate&&"function"==typeof document.createElement("input").reportValidity&&$form&&$form[0]&&!$form[0].checkValidity())return $form[0].reportValidity(),!1;$el.trigger("ajaxSetup",[context]);var _event=jQuery.Event("oc.beforeRequest");if($triggerEl.trigger(_event,context),!_event.isDefaultPrevented()){var loading=void 0!==options.loading?options.loading:null,url=void 0!==options.url?options.url:window.location.href,isRedirect=void 0!==options.redirect&&options.redirect.length,useFlash=void 0!==options.flash,useFiles=void 0!==options.files;useFiles&&"undefined"==typeof FormData&&(console.warn("This browser does not support file uploads via FormData"),useFiles=!1),"string"==$.type(loading)&&(loading=$(loading));var requestHeaders={"X-OCTOBER-REQUEST-HANDLER":handler,"X-OCTOBER-REQUEST-PARTIALS":this.extractPartials(options.update)};useFlash&&(requestHeaders["X-OCTOBER-REQUEST-FLASH"]=1);var csrfToken=getXSRFToken();csrfToken&&(requestHeaders["X-XSRF-TOKEN"]=csrfToken);var requestData,inputName,data={};$.each($el.parents("[data-request-data]").toArray().reverse(),(function(){$.extend(data,paramToObj("data-request-data",$(this).data("request-data")))})),$el.is(":input")&&!$form.length&&(inputName=$el.attr("name"),void 0!==inputName&&void 0===options.data[inputName]&&(options.data[inputName]=$el.val())),void 0===options.data||$.isEmptyObject(options.data)||$.extend(data,options.data),useFiles?(requestData=new FormData($form.length?$form.get(0):void 0),$el.is(":file")&&inputName&&($.each($el.prop("files"),(function(){requestData.append(inputName,this)})),delete data[inputName]),$.each(data,(function(e){"undefined"!=typeof Blob&&this instanceof Blob&&this.filename?requestData.append(e,this,this.filename):requestData.append(e,this)}))):requestData=[$form.serialize(),$.param(data)].filter(Boolean).join("&");var requestOptions={url:url,crossDomain:!1,global:options.ajaxGlobal,context:context,headers:requestHeaders,success:function(data,textStatus,jqXHR){if(!1!==this.options.beforeUpdate.apply(this,[data,textStatus,jqXHR])&&(!options.evalBeforeUpdate||!1!==eval("(function($el, context, data, textStatus, jqXHR) {"+options.evalBeforeUpdate+"}.call($el.get(0), $el, context, data, textStatus, jqXHR))"))){var _event=jQuery.Event("ajaxBeforeUpdate");if($triggerEl.trigger(_event,[context,data,textStatus,jqXHR]),!_event.isDefaultPrevented()){useFlash&&data.X_OCTOBER_FLASH_MESSAGES&&$.each(data.X_OCTOBER_FLASH_MESSAGES,(function(e,t){requestOptions.handleFlashMessage(t,e)}));var updatePromise=requestOptions.handleUpdateResponse(data,textStatus,jqXHR);return updatePromise.done((function(){$triggerEl.trigger("ajaxSuccess",[context,data,textStatus,jqXHR]),options.evalSuccess&&eval("(function($el, context, data, textStatus, jqXHR) {"+options.evalSuccess+"}.call($el.get(0), $el, context, data, textStatus, jqXHR))")})),updatePromise}}},error:function(jqXHR,textStatus,errorThrown){var errorMsg,updatePromise=$.Deferred();if(!(void 0!==window.ocUnloading&&window.ocUnloading||"abort"==errorThrown))return isRedirect=!1,options.redirect=null,406==jqXHR.status&&jqXHR.responseJSON?(errorMsg=jqXHR.responseJSON.X_OCTOBER_ERROR_MESSAGE,updatePromise=requestOptions.handleUpdateResponse(jqXHR.responseJSON,textStatus,jqXHR)):(errorMsg=jqXHR.responseText?jqXHR.responseText:jqXHR.statusText,updatePromise.resolve()),updatePromise.done((function(){$el.data("error-message",errorMsg);var _event=jQuery.Event("ajaxError");$triggerEl.trigger(_event,[context,errorMsg,textStatus,jqXHR]),_event.isDefaultPrevented()||options.evalError&&!1===eval("(function($el, context, errorMsg, textStatus, jqXHR) {"+options.evalError+"}.call($el.get(0), $el, context, errorMsg, textStatus, jqXHR))")||requestOptions.handleErrorMessage(errorMsg)})),updatePromise},complete:function(data,textStatus,jqXHR){$triggerEl.trigger("ajaxComplete",[context,data,textStatus,jqXHR]),options.evalComplete&&eval("(function($el, context, data, textStatus, jqXHR) {"+options.evalComplete+"}.call($el.get(0), $el, context, data, textStatus, jqXHR))")},handleConfirmMessage:function(e){var t=jQuery.Event("ajaxConfirmMessage");return t.promise=$.Deferred(),void 0!==$(window).triggerHandler(t,[e])?(t.promise.done((function(){options.confirm=null,new Request(element,handler,options)})),!1):t.isDefaultPrevented()?void 0:e?confirm(e):void 0},handleErrorMessage:function(e){var t=jQuery.Event("ajaxErrorMessage");$(window).trigger(t,[e]),t.isDefaultPrevented()||e&&alert(e)},handleValidationMessage:function(e,t){$triggerEl.trigger("ajaxValidation",[context,e,t]);var r=!0;$.each(t,(function(e,t){e=e.replace(/\.(\w+)/g,"[$1]");var n=$form.find('[name="'+e+'"], [name="'+e+'[]"], [name$="['+e+']"], [name$="['+e+'][]"]').filter(":enabled").first();if(n.length>0){var a=jQuery.Event("ajaxInvalidField");$(window).trigger(a,[n.get(0),e,t,r]),r&&(a.isDefaultPrevented()||n.focus(),r=!1)}}))},handleFlashMessage:function(e,t){},handleRedirectResponse:function(e){window.location.assign(e)},handleUpdateResponse:function(e,t,r){var n=$.Deferred().done((function(){for(var n in e){var a=options.update[n]?options.update[n]:n;"string"==$.type(a)&&"@"==a.charAt(0)?$(a.substring(1)).append(e[n]).trigger("ajaxUpdate",[context,e,t,r]):"string"==$.type(a)&&"^"==a.charAt(0)?$(a.substring(1)).prepend(e[n]).trigger("ajaxUpdate",[context,e,t,r]):($(a).trigger("ajaxBeforeReplace"),$(a).html(e[n]).trigger("ajaxUpdate",[context,e,t,r]))}setTimeout((function(){$(window).trigger("ajaxUpdateComplete",[context,e,t,r]).trigger("resize")}),0)}));return e.X_OCTOBER_REDIRECT&&(options.redirect=e.X_OCTOBER_REDIRECT,isRedirect=!0),isRedirect&&requestOptions.handleRedirectResponse(options.redirect),e.X_OCTOBER_ERROR_FIELDS&&requestOptions.handleValidationMessage(e.X_OCTOBER_ERROR_MESSAGE,e.X_OCTOBER_ERROR_FIELDS),e.X_OCTOBER_ASSETS?assetManager.load(e.X_OCTOBER_ASSETS,$.proxy(n.resolve,n)):n.resolve(),n}};if(useFiles&&(requestOptions.processData=requestOptions.contentType=!1),context.success=requestOptions.success,context.error=requestOptions.error,context.complete=requestOptions.complete,requestOptions=$.extend(requestOptions,options),requestOptions.data=requestData,!options.confirm||requestOptions.handleConfirmMessage(options.confirm))return loading&&loading.show(),$(window).trigger("ajaxBeforeSend",[context]),$el.trigger("ajaxPromise",[context]),$.ajax(requestOptions).fail((function(e,t,r){isRedirect||$el.trigger("ajaxFail",[context,t,e]),loading&&loading.hide()})).done((function(e,t,r){isRedirect||$el.trigger("ajaxDone",[context,e,t,r]),loading&&loading.hide()})).always((function(e,t,r){$el.trigger("ajaxAlways",[context,e,t,r])}))}};Request.DEFAULTS={update:{},type:"POST",beforeUpdate:function(e,t,r){},evalBeforeUpdate:null,evalSuccess:null,evalError:null,evalComplete:null,ajaxGlobal:!1},Request.prototype.extractPartials=function(e){var t=[];for(var r in e)t.push(r);return t.join("&")};var old=$.fn.request;function paramToObj(e,t){if(void 0===t&&(t=""),"object"==typeof t)return t;try{return ocJSON("{"+t+"}")}catch(t){throw new Error("Error parsing the "+e+" attribute value. "+t)}}function getXSRFToken(){var e=null;if(document.cookie&&""!=document.cookie)for(var t=document.cookie.split(";"),r=0;r<t.length;r++){var n=jQuery.trim(t[r]);if("XSRF-TOKEN="==n.substring(0,11)){e=decodeURIComponent(n.substring(11));break}}return e}$.fn.request=function(e,t){var r=$(this).first(),n={evalBeforeUpdate:r.data("request-before-update"),evalSuccess:r.data("request-success"),evalError:r.data("request-error"),evalComplete:r.data("request-complete"),ajaxGlobal:r.data("request-ajax-global"),confirm:r.data("request-confirm"),redirect:r.data("request-redirect"),loading:r.data("request-loading"),flash:r.data("request-flash"),files:r.data("request-files"),browserValidate:r.data("browser-validate"),form:r.data("request-form"),url:r.data("request-url"),update:paramToObj("data-request-update",r.data("request-update")),data:paramToObj("data-request-data",r.data("request-data"))};e||(e=r.data("request"));var a=$.extend(!0,{},Request.DEFAULTS,n,"object"==typeof t&&t);return new Request(r,e,a)},$.fn.request.Constructor=Request,$.request=function(e,t){return $(document).request(e,t)},$.fn.request.noConflict=function(){return $.fn.request=old,this},$(document).on("change","select[data-request], input[type=radio][data-request], input[type=checkbox][data-request], input[type=file][data-request]",(function(){$(this).request()})),$(document).on("click","a[data-request], button[data-request], input[type=button][data-request], input[type=submit][data-request]",(function(e){if(e.preventDefault(),$(this).request(),$(this).is("[type=submit]"))return!1})),$(document).on("keydown","input[type=text][data-request], input[type=submit][data-request], input[type=password][data-request]",(function(e){if("Enter"===e.key)return void 0!==this.dataTrackInputTimer&&window.clearTimeout(this.dataTrackInputTimer),$(this).request(),!1})),$(document).on("input","input[data-request][data-track-input]",(function(e){var t=$(this),r=t.data("oc.lastvalue");if(t.is("[type=email],[type=number],[type=password],[type=search],[type=text]")&&(void 0===r||r!=this.value)){t.data("oc.lastvalue",this.value),void 0!==this.dataTrackInputTimer&&window.clearTimeout(this.dataTrackInputTimer);var n=$(this).data("track-input");n||(n=300);var a=this;this.dataTrackInputTimer=window.setTimeout((function(){a.lastDataTrackInputRequest&&a.lastDataTrackInputRequest.abort(),a.lastDataTrackInputRequest=$(a).request()}),n)}})),$(document).on("submit","[data-request]",(function(){return $(this).request(),!1})),$(window).on("beforeunload",(function(){window.ocUnloading=!0})),$(document).ready((function(){$(document).trigger("render")})),$(window).on("ajaxUpdateComplete",(function(){$(document).trigger("render")})),$.fn.render=function(e){$(document).on("render",e)}}(window.jQuery),function(e){"use strict";function t(e,t,r){for(var n="",a=t;a<e.length;a++){if(r&&r===e[a])return n;if(!r&&(" "===e[a]||":"===e[a]))return n;n+=e[a],"\\"===e[a]&&a+1<e.length&&(n+=e[a+1],a++)}throw new Error("Broken JSON syntax near "+n)}function r(e,t){if('"'===e[t]||"'"===e[t]){for(var r=e[t],n=t+1;n<e.length;n++)if("\\"===e[n])r+=e[n],n+1<e.length&&(r+=e[n+1]),n++;else{if(e[n]===e[t])return{originLength:(r+=e[t]).length,body:r};r+=e[n]}throw new Error("Broken JSON string body near "+r)}if("t"===e[t]){if(e.indexOf("true",t)===t)return{originLength:"true".length,body:"true"};throw new Error("Broken JSON boolean body near "+e.substr(0,t+10))}if("f"===e[t]){if(e.indexOf("f",t)===t)return{originLength:"false".length,body:"false"};throw new Error("Broken JSON boolean body near "+e.substr(0,t+10))}if("n"===e[t]){if(e.indexOf("null",t)===t)return{originLength:"null".length,body:"null"};throw new Error("Broken JSON boolean body near "+e.substr(0,t+10))}if("-"===e[t]||"+"===e[t]||"."===e[t]||e[t]>="0"&&e[t]<="9"){for(r="",n=t;n<e.length;n++){if(!("-"===e[n]||"+"===e[n]||"."===e[n]||e[n]>="0"&&e[n]<="9"))return{originLength:r.length,body:r};r+=e[n]}throw new Error("Broken JSON number body near "+r)}if("{"===e[t]||"["===e[t]){var a=[e[t]];for(r=e[t],n=t+1;n<e.length;n++){if(r+=e[n],"\\"===e[n])n+1<e.length&&(r+=e[n+1]),n++;else if('"'===e[n])'"'===a[a.length-1]?a.pop():"'"!==a[a.length-1]&&a.push(e[n]);else if("'"===e[n])"'"===a[a.length-1]?a.pop():'"'!==a[a.length-1]&&a.push(e[n]);else if('"'!==a[a.length-1]&&"'"!==a[a.length-1])if("{"===e[n])a.push("{");else if("}"===e[n]){if("{"!==a[a.length-1])throw new Error("Broken JSON "+("{"===e[t]?"object":"array")+" body near "+r);a.pop()}else if("["===e[n])a.push("[");else if("]"===e[n]){if("["!==a[a.length-1])throw new Error("Broken JSON "+("{"===e[t]?"object":"array")+" body near "+r);a.pop()}if(!a.length)return{originLength:n-t,body:r}}throw new Error("Broken JSON "+("{"===e[t]?"object":"array")+" body near "+r)}throw new Error("Broken JSON body near "+e.substr(t-5>=0?t-5:0,50))}function n(e){return" "===e||"\n"===e||"\t"===e}function a(e){if(!(e=e.trim()).length)throw new Error("Broken JSON object.");for(var o="";e&&","===e[0];)e=e.substr(1);if('"'===e[0]||"'"===e[0]){if(e[e.length-1]!==e[0])throw new Error("Invalid string JSON object.");for(var i='"',s=1;s<e.length;s++)if("\\"===e[s])"'"===e[s+1]||(i+=e[s]),i+=e[s+1],s++;else{if(e[s]===e[0])return i+='"';'"'===e[s]?i+='\\"':i+=e[s]}throw new Error("Invalid string JSON object.")}if("true"===e||"false"===e)return e;if("null"===e)return"null";var u,d=parseFloat(e);if(!isNaN(d))return d.toString();if("{"===e[0]){var l="needKey";for(o="{",s=1;s<e.length;s++){if(!n(e[s]))if("needKey"!==l||'"'!==e[s]&&"'"!==e[s]){if("needKey"===l&&("\\"!==(u=e[s])[0]&&(u[0]>="a"&&u[0]<="z"||u[0]>="A"&&u[0]<="Z"||"_"===u[0]||u[0]>="0"&&u[0]<="9"||"$"===u[0]||u.charCodeAt(0)>255))){var f;o+='"',o+=f=t(e,s),o+='"',s+=f.length-1,l="afterKey"}else if("afterKey"===l&&":"===e[s])o+=":",l=":";else if(":"===l){s=s+(i=r(e,s)).originLength-1,o+=a(i.body),l="afterBody"}else if("afterBody"===l||"needKey"===l){for(var c=s;","===e[c]||n(e[c]);)c++;if("}"===e[c]&&c===e.length-1){for(;","===o[o.length-1];)o=o.substr(0,o.length-1);return o+="}"}c!==s&&"{"!==o&&(o+=",",l="needKey",s=c-1)}}else o+='"'+(f=t(e,s+1,e[s]))+'"',s+=f.length,s+=1,l="afterKey"}throw new Error("Broken JSON object near "+o)}if("["===e[0]){for(o="[",l="needBody",s=1;s<e.length;s++)if(" "!==e[s]&&"\n"!==e[s]&&"\t"!==e[s])if("needBody"===l){if(","===e[s]){o+="null,";continue}if("]"===e[s]&&s===e.length-1)return","===o[o.length-1]&&(o=o.substr(0,o.length-1)),o+="]";s=s+(i=r(e,s)).originLength-1,o+=a(i.body),l="afterBody"}else if("afterBody"===l)if(","===e[s])for(o+=",",l="needBody";","===e[s+1]||n(e[s+1]);)","===e[s+1]&&(o+="null,"),s++;else if("]"===e[s]&&s===e.length-1)return o+="]";throw new Error("Broken JSON array near "+o)}}e.ocJSON=function(e){var t=a(e);return JSON.parse(t)}}(window),function(e){"use strict";function t(e){var t=$($.parseHTML("<div>"+e+"</div>",null,!1));return t.find("*").each((function(){var e;e=this,$.each(e.attributes,(function(){var t=this.name,r=this.value;0!=t.indexOf("on")&&0!=r.indexOf("javascript:")||$(e).removeAttr(t)}))})),t.html()}e.ocSanitize=function(e){return t(e)}}(window);